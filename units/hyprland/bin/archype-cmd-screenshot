#!/bin/bash

[[ -f ~/.config/user-dirs.dirs ]] && source ~/.config/user-dirs.dirs
OUTPUT_DIR="${XDG_SCREENSHOTS_DIR:-${XDG_PICTURES_DIR}/Screenshots}"

if [[ -z "$OUTPUT_DIR" ]]; then
  notify-send "Save failed" "Pictures directory is not defined.\nCan be set with: xdg-user-dirs-update --set PICTURES \"\$HOME/Pictures\"" -u critical -t 300
  exit 1
fi

mkdir -p $OUTPUT_DIR

pkill slurp || hyprshot -m ${1:-region} --raw |
  satty --filename - \
    --output-filename "$OUTPUT_DIR/screenshot-$(date +'%Y-%m-%d_%H-%M-%S').png" \
    --early-exit \
    --actions-on-enter save-to-clipboard \
    --save-after-copy \
    --copy-command 'wl-copy'
